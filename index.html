<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="增肌训练计划，提供详细的训练动作指导、一周训练5天，休息2天，支持循环显示，包含进度记录、饮食建议等功能。">
    <meta name="keywords" content="增肌, 训练计划, 杠铃肩推, 深蹲, 硬拉, 卧推, 健身, PWA">
    <meta name="author" content="健身爱好者">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="manifest" href="manifest.json">
    <title>增肌训练计划 - 一周循环</title>
    <style>
        :root {
            --primary-color: #007BFF;
            --hover-color: #0056b3;
            --background-color: #f4f4f4;
            --details-bg: #e8f0ff;
            --table-border: #ddd;
            --rest-day-bg: #f8d7da;
            --rest-day-text: #5a1a20;
            --success-color: #28a745;
            --warning-color: #ffc107;
        }

        body.dark-mode {
            --primary-color: #66b0ff;
            --hover-color: #99c7ff;
            --background-color: #1a1a1a;
            --details-bg: #2c3e50;
            --table-border: #444;
            --rest-day-bg: #5c2d2d;
            --rest-day-text: #f5c6cb;
            --success-color: #2ecc71;
            --warning-color: #f1c40f;
        }

        body.dark-mode .container { background: #2a2a2a; color: #f4f4f4; }
        body.dark-mode td { background-color: #333; }
        body.dark-mode th { background-color: var(--primary-color); }
        body.dark-mode .nutrition-tips { background: var(--warning-color); color: #1a1a1a; }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: Arial, sans-serif; background-color: var(--background-color); padding: 20px; text-align: center; line-height: 1.6; }
        .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); }
        h2 { color: #333; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 16px; }
        th, td { border: 1px solid var(--table-border); padding: 10px; text-align: center; }
        th { background-color: var(--primary-color); color: white; font-weight: bold; }
        td { background-color: #fff; }
        .rest-day { background-color: var(--rest-day-bg); color: var(--rest-day-text); font-weight: bold; }
        .exercise { background: var(--primary-color); color: white; padding: 8px; border-radius: 5px; cursor: pointer; text-align: center; font-weight: bold; transition: background 0.3s ease; display: block; width: 100%; border: none; margin-bottom: 5px; }
        .exercise:hover { background: var(--hover-color); }
        .details { display: none; background: var(--details-bg); padding: 10px; border-radius: 5px; margin-top: 5px; text-align: left; }
        .details[aria-hidden="false"] { display: block; }
        .progress-form { margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px; }
        .progress-form input, .progress-form textarea { width: 100%; padding: 5px; margin: 5px 0; border: 1px solid var(--table-border); border-radius: 5px; }
        .progress-form button { background: var(--success-color); color: white; padding: 5px 10px; border: none; border-radius: 5px; cursor: pointer; }
        .nutrition-tips { background: var(--warning-color); padding: 10px; border-radius: 5px; margin-top: 10px; color: #333; }
        .login-form, .register-form { max-width: 400px; margin: 20px auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); display: none; }
        .login-form.active, .register-form.active { display: block; }
        .login-form input, .register-form input { width: 100%; padding: 8px; margin: 10px 0; border: 1px solid var(--table-border); border-radius: 5px; }
        .login-form button, .register-form button { background: var(--success-color); color: white; padding: 10px; border: none; border-radius: 5px; cursor: pointer; }
        .chart-container { width: 100%; max-width: 800px; margin: 20px auto; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); }
        canvas { max-width: 100%; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <button id="theme-toggle" class="exercise">切换深色模式</button>
        <h2>增肌训练计划 - 一周循环</h2>
        <div class="login-form">
            <h3>登录</h3>
            <input type="text" id="login-username" placeholder="用户名" required>
            <input type="password" id="login-password" placeholder="密码" required>
            <button onclick="login()">登录</button>
            <p>没有账号？<a href="#" onclick="showRegister()">注册</a></p>
        </div>
        <div class="register-form">
            <h3>注册</h3>
            <input type="text" id="register-username" placeholder="用户名" required>
            <input type="password" id="register-password" placeholder="密码" required>
            <input type="number" id="register-weight" placeholder="当前体重 (kg)" required>
            <input type="number" id="register-height" placeholder="身高 (cm)" required>
            <button onclick="register()">注册</button>
            <p>已有账号？<a href="#" onclick="showLogin()">登录</a></p>
        </div>
        <div id="user-welcome" style="display: none;">
            <h3>欢迎, <span id="user-name"></span>!</h3>
            <button class="exercise" onclick="logout()">退出登录</button>
            <p>体重: <span id="user-weight"></span> kg</p>
            <p>身高: <span id="user-height"></span> cm</p>
        </div>

        <p>以下为一周训练计划，训练 5 天，休息 2 天（周六、周日）。可循环执行。</p>
        <table>
            <thead>
                <tr>
                    <th>星期</th>
                    <th>训练内容</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>周一</td>
                    <td>
                        <button class="exercise" aria-expanded="false" aria-controls="monday_warmup" onclick="toggleDetails('monday_warmup')">热身</button>
                        <div id="monday_warmup" class="details" aria-hidden="true">
                            <p>1. 动态拉伸：肩部绕环、胸部开合 - 5 分钟</p>
                            <p>2. 轻重量卧推热身 - 2 组 x 15 次</p>
                        </div>
                        <button class="exercise" aria-expanded="false" aria-controls="monday_bench_press" onclick="toggleDetails('monday_bench_press')">杠铃卧推（主动作）</button>
                        <div id="monday_bench_press" class="details" aria-hidden="true">
                            <p>1. 仰卧在凳子上，双脚稳踏地面。</p>
                            <p>2. 手握杠铃略宽于肩，控制下降至胸部。</p>
                            <p>3. 发力向上推起至手臂伸直。</p>
                            <p>组数：4 组 x 8-12 次，休息 90 秒</p>
                            <p><a href="https://www.youtube.com/watch?v=4Y2ZdHCOXok" target="_blank" class="video-link">查看动作视频</a></p>
                        </div>
                        <button class="exercise" aria-expanded="false" aria-controls="monday_shoulder_press" onclick="toggleDetails('monday_shoulder_press')">杠铃肩推（辅助动作）</button>
                        <div id="monday_shoulder_press" class="details" aria-hidden="true">
                            <p>组数：3 组 x 10-12 次，休息 60 秒</p>
                        </div>
                        <button class="exercise" aria-expanded="false" aria-controls="monday_progress" onclick="toggleDetails('monday_progress')">记录训练进度</button>
                        <div id="monday_progress" class="details" aria-hidden="true">
                            <form class="progress-form" onsubmit="saveProgress(event, 'monday')">
                                <label>杠铃卧推 - 重量 (kg):</label>
                                <input type="number" name="monday_weight" placeholder="输入重量" required>
                                <label>杠铃卧推 - 组数/次数:</label>
                                <input type="text" name="monday_sets" placeholder="例如 4x10" required>
                                <label>训练感受:</label>
                                <textarea name="notes" placeholder="记录你的感受" rows="3"></textarea>
                                <label>当前体重 (kg):</label>
                                <input type="number" name="current_weight" placeholder="输入当前体重" required>
                                <button type="submit">保存</button>
                            </form>
                        </div>
                        <button class="exercise" aria-expanded="false" aria-controls="monday_nutrition" onclick="toggleDetails('monday_nutrition')">饮食建议</button>
                        <div id="monday_nutrition" class="details nutrition-tips" aria-hidden="true">
                            <p>1. 蛋白质：摄入 1.6-2.2g/kg 体重的蛋白质，例如鸡胸肉、鱼、蛋白粉。</p>
                            <p>2. 碳水化合物：训练后摄入高 GI 碳水，例如白米饭、香蕉。</p>
                            <p>3. 脂肪：适量摄入健康脂肪，例如牛油果、坚果。</p>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>周二</td>
                    <td>
                        <button class="exercise" aria-expanded="false" aria-controls="tuesday_deadlift" onclick="toggleDetails('tuesday_deadlift')">硬拉（主动作）</button>
                        <div id="tuesday_deadlift" class="details" aria-hidden="true">
                            <p>组数：4 组 x 6-8 次，休息 90 秒</p>
                        </div>
                        <button class="exercise" aria-expanded="false" aria-controls="tuesday_progress" onclick="toggleDetails('tuesday_progress')">记录训练进度</button>
                        <div id="tuesday_progress" class="details" aria-hidden="true">
                            <form class="progress-form" onsubmit="saveProgress(event, 'tuesday')">
                                <label>硬拉 - 重量 (kg):</label>
                                <input type="number" name="tuesday_weight" placeholder="输入重量" required>
                                <label>硬拉 - 组数/次数:</label>
                                <input type="text" name="tuesday_sets" placeholder="例如 4x6" required>
                                <label>训练感受:</label>
                                <textarea name="notes" placeholder="记录你的感受" rows="3"></textarea>
                                <label>当前体重 (kg):</label>
                                <input type="number" name="current_weight" placeholder="输入当前体重" required>
                                <button type="submit">保存</button>
                            </form>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>周三</td>
                    <td>
                        <button class="exercise" aria-expanded="false" aria-controls="wednesday_squat" onclick="toggleDetails('wednesday_squat')">深蹲（主动作）</button>
                        <div id="wednesday_squat" class="details" aria-hidden="true">
                            <p>组数：4 组 x 8-12 次，休息 90 秒</p>
                        </div>
                        <button class="exercise" aria-expanded="false" aria-controls="wednesday_progress" onclick="toggleDetails('wednesday_progress')">记录训练进度</button>
                        <div id="wednesday_progress" class="details" aria-hidden="true">
                            <form class="progress-form" onsubmit="saveProgress(event, 'wednesday')">
                                <label>深蹲 - 重量 (kg):</label>
                                <input type="number" name="wednesday_weight" placeholder="输入重量" required>
                                <label>深蹲 - 组数/次数:</label>
                                <input type="text" name="wednesday_sets" placeholder="例如 4x10" required>
                                <label>训练感受:</label>
                                <textarea name="notes" placeholder="记录你的感受" rows="3"></textarea>
                                <label>当前体重 (kg):</label>
                                <input type="number" name="current_weight" placeholder="输入当前体重" required>
                                <button type="submit">保存</button>
                            </form>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>周四</td>
                    <td>
                        <button class="exercise" aria-expanded="false" aria-controls="thursday_incline_bench" onclick="toggleDetails('thursday_incline_bench')">上斜杠铃卧推（主动作）</button>
                        <div id="thursday_incline_bench" class="details" aria-hidden="true">
                            <p>组数：4 组 x 8-12 次，休息 90 秒</p>
                        </div>
                        <button class="exercise" aria-expanded="false" aria-controls="thursday_progress" onclick="toggleDetails('thursday_progress')">记录训练进度</button>
                        <div id="thursday_progress" class="details" aria-hidden="true">
                            <form class="progress-form" onsubmit="saveProgress(event, 'thursday')">
                                <label>上斜杠铃卧推 - 重量 (kg):</label>
                                <input type="number" name="thursday_weight" placeholder="输入重量" required>
                                <label>上斜杠铃卧推 - 组数/次数:</label>
                                <input type="text" name="thursday_sets" placeholder="例如 4x10" required>
                                <label>训练感受:</label>
                                <textarea name="notes" placeholder="记录你的感受" rows="3"></textarea>
                                <label>当前体重 (kg):</label>
                                <input type="number" name="current_weight" placeholder="输入当前体重" required>
                                <button type="submit">保存</button>
                            </form>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>周五</td>
                    <td>
                        <button class="exercise" aria-expanded="false" aria-controls="friday_row" onclick="toggleDetails('friday_row')">杠铃划船（主动作）</button>
                        <div id="friday_row" class="details" aria-hidden="true">
                            <p>组数：4 组 x 8-12 次，休息 90 秒</p>
                        </div>
                        <button class="exercise" aria-expanded="false" aria-controls="friday_progress" onclick="toggleDetails('friday_progress')">记录训练进度</button>
                        <div id="friday_progress" class="details" aria-hidden="true">
                            <form class="progress-form" onsubmit="saveProgress(event, 'friday')">
                                <label>杠铃划船 - 重量 (kg):</label>
                                <input type="number" name="friday_weight" placeholder="输入重量" required>
                                <label>杠铃划船 - 组数/次数:</label>
                                <input type="text" name="friday_sets" placeholder="例如 4x10" required>
                                <label>训练感受:</label>
                                <textarea name="notes" placeholder="记录你的感受" rows="3"></textarea>
                                <label>当前体重 (kg):</label>
                                <input type="number" name="current_weight" placeholder="输入当前体重" required>
                                <button type="submit">保存</button>
                            </form>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="rest-day">周六</td>
                    <td class="rest-day">
                        <p>休息日 - 建议进行轻度活动（如散步）或完全休息。</p>
                    </td>
                </tr>
                <tr>
                    <td class="rest-day">周日</td>
                    <td class="rest-day">
                        <p>休息日 - 建议进行轻度活动（如瑜伽）或完全休息。</p>
                    </td>
                </tr>
            </tbody>
        </table>

        <button class="exercise" aria-expanded="false" aria-controls="progress_summary" onclick="toggleDetails('progress_summary')">查看训练进度</button>
        <div id="progress_summary" class="details" aria-hidden="true">
            <p>以下是您记录的训练进度。</p>
            <div id="progress_data"></div>
            <div class="chart-container">
                <h3>训练重量变化</h3>
                <canvas id="weightChart"></canvas>
            </div>
            <div class="chart-container">
                <h3>体重变化曲线</h3>
                <canvas id="bodyWeightChart"></canvas>
            </div>
            <button class="exercise" onclick="clearProgress()">清除所有记录</button>
        </div>
    </div>

    <script>
        let db;
        const DB_NAME = 'FitnessAppDB';
        const USER_STORE = 'users';
        const PROGRESS_STORE = 'progress';
        let currentUser = null;
        let weightChart, bodyWeightChart;

        function initDB() {
            const request = indexedDB.open(DB_NAME, 1);
            request.onupgradeneeded = event => {
                db = event.target.result;
                db.createObjectStore(USER_STORE, { keyPath: 'username' });
                db.createObjectStore(PROGRESS_STORE, { keyPath: 'id', autoIncrement: true });
            };
            request.onsuccess = event => {
                db = event.target.result;
                checkLoginStatus();
            };
            request.onerror = event => console.error('IndexedDB 初始化失败:', event.target.error);
        }

        function showLogin() { document.querySelector('.login-form').classList.add('active'); document.querySelector('.register-form').classList.remove('active'); }
        function showRegister() { document.querySelector('.register-form').classList.add('active'); document.querySelector('.login-form').classList.remove('active'); }

        function register() {
            const username = document.getElementById('register-username').value;
            const password = document.getElementById('register-password').value;
            const weight = document.getElementById('register-weight').value;
            const height = document.getElementById('register-height').value;

            if (!username || !password || !weight || !height) {
                alert('请填写所有字段！');
                return;
            }

            const transaction = db.transaction([USER_STORE], 'readwrite');
            const store = transaction.objectStore(USER_STORE);
            const request = store.get(username);

            request.onsuccess = () => {
                if (request.result) {
                    alert('用户名已存在！');
                } else {
                    const user = { username, password, weight, height, progress: [] };
                    store.add(user);
                    transaction.oncomplete = () => {
                        alert('注册成功！请登录。');
                        showLogin();
                        document.querySelector('.register-form').reset();
                    };
                }
            };
        }

        function login() {
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;

            const transaction = db.transaction([USER_STORE], 'readonly');
            const store = transaction.objectStore(USER_STORE);
            const request = store.get(username);

            request.onsuccess = () => {
                const user = request.result;
                if (user && user.password === password) {
                    currentUser = user;
                    document.querySelector('.login-form').classList.remove('active');
                    document.getElementById('user-name').textContent = username;
                    document.getElementById('user-weight').textContent = user.weight;
                    document.getElementById('user-height').textContent = user.height;
                    document.getElementById('user-welcome').style.display = 'block';
                    displayProgress();
                    renderCharts();
                } else {
                    alert('用户名或密码错误！');
                }
            };
        }

        function logout() {
            currentUser = null;
            document.getElementById('user-welcome').style.display = 'none';
            showLogin();
            if (weightChart) weightChart.destroy();
            if (bodyWeightChart) bodyWeightChart.destroy();
        }

        function checkLoginStatus() {
            if (currentUser) {
                document.getElementById('user-name').textContent = currentUser.username;
                document.getElementById('user-weight').textContent = currentUser.weight;
                document.getElementById('user-height').textContent = currentUser.height;
                document.getElementById('user-welcome').style.display = 'block';
            } else {
                showLogin();
            }
        }

        function saveProgress(event, day) {
            event.preventDefault();
            if (!currentUser) {
                alert('请先登录！');
                return;
            }

            const form = event.target;
            const button = form.querySelector('button');
            button.classList.add('loading');
            button.disabled = true;

            const formData = new FormData(form);
            const weight = formData.get(`${day}_weight`);
            const sets = formData.get(`${day}_sets`);
            const notes = formData.get('notes');
            const currentWeight = formData.get('current_weight');

            if (!weight || isNaN(weight) || weight <= 0) {
                alert('请输入有效的重量（正数）！');
                button.classList.remove('loading');
                button.disabled = false;
                return;
            }

            if (!sets.match(/^\d+x\d+$/)) {
                alert('请输入有效的组数/次数，格式如 4x10！');
                button.classList.remove('loading');
                button.disabled = false;
                return;
            }

            if (!currentWeight || isNaN(currentWeight) || currentWeight <= 0) {
                alert('请输入有效的当前体重！');
                button.classList.remove('loading');
                button.disabled = false;
                return;
            }

            const progress = {
                day,
                weight,
                sets,
                notes,
                currentWeight,
                date: new Date().toLocaleString(),
                user: currentUser.username
            };

            const transaction = db.transaction([PROGRESS_STORE], 'readwrite');
            const store = transaction.objectStore(PROGRESS_STORE);
            store.add(progress);

            transaction.oncomplete = () => {
                button.classList.remove('loading');
                button.disabled = false;
                alert('进度已保存！');
                form.reset();
                displayProgress();
                renderCharts();
                updateUserProgress(progress);
            };
        }

        function updateUserProgress(progress) {
            const transaction = db.transaction([USER_STORE], 'readwrite');
            const store = transaction.objectStore(USER_STORE);
            const request = store.get(currentUser.username);

            request.onsuccess = () => {
                const user = request.result;
                user.progress.push(progress);
                user.weight = progress.currentWeight;
                store.put(user);
                document.getElementById('user-weight').textContent = user.weight;
            };
        }

        function displayProgress() {
            if (!currentUser) {
                document.getElementById('progress_data').innerHTML = '<p>请登录以查看进度。</p>';
                return;
            }

            const transaction = db.transaction([PROGRESS_STORE], 'readonly');
            const store = transaction.objectStore(PROGRESS_STORE);
            const request = store.getAll();

            request.onsuccess = () => {
                const progressData = request.result.filter(p => p.user === currentUser.username);
                const progressDiv = document.getElementById('progress_data');
                progressDiv.innerHTML = '';

                const groupedData = {};
                progressData.forEach(entry => {
                    if (!groupedData[entry.day]) groupedData[entry.day] = [];
                    groupedData[entry.day].push(entry);
                });

                for (const day in groupedData) {
                    progressDiv.innerHTML += `<h3>${day}</h3>`;
                    groupedData[day].forEach((entry, index) => {
                        progressDiv.innerHTML += `
                            <p>记录 ${index + 1} (${entry.date}):</p>
                            <p>重量: ${entry.weight} kg</p>
                            <p>组数/次数: ${entry.sets}</p>
                            <p>感受: ${entry.notes || '无'}</p>
                            <p>当前体重: ${entry.currentWeight} kg</p>
                            <hr>
                        `;
                    });
                }
            };
        }

        function clearProgress() {
            if (confirm('确定要清除所有训练进度吗？此操作不可恢复。')) {
                const transaction = db.transaction([PROGRESS_STORE], 'readwrite');
                const store = transaction.objectStore(PROGRESS_STORE);
                store.clear();
                transaction.oncomplete = () => {
                    displayProgress();
                    renderCharts();
                    alert('所有记录已清除！');
                    if (currentUser) updateUserProgress([]);
                };
            }
        }

        function renderCharts() {
            if (!currentUser) return;

            const transaction = db.transaction([PROGRESS_STORE], 'readonly');
            const store = transaction.objectStore(PROGRESS_STORE);
            const request = store.getAll();

            request.onsuccess = () => {
                const progressData = request.result.filter(p => p.user === currentUser.username)
                    .sort((a, b) => new Date(a.date) - new Date(b.date));

                const weightLabels = progressData.map(p => p.date);
                const weightValues = progressData.map(p => parseFloat(p.weight));
                if (weightChart) weightChart.destroy();
                weightChart = new Chart(document.getElementById('weightChart'), {
                    type: 'line',
                    data: {
                        labels: weightLabels,
                        datasets: [{
                            label: '训练重量 (kg)',
                            data: weightValues,
                            borderColor: 'rgba(75, 192, 192, 1)',
                            fill: false
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: { y: { beginAtZero: true } },
                        plugins: { legend: { position: 'top' } }
                    }
                });

                const bodyWeightValues = progressData.map(p => parseFloat(p.currentWeight));
                if (bodyWeightChart) bodyWeightChart.destroy();
                bodyWeightChart = new Chart(document.getElementById('bodyWeightChart'), {
                    type: 'line',
                    data: {
                        labels: weightLabels,
                        datasets: [{
                            label: '体重 (kg)',
                            data: bodyWeightValues,
                            borderColor: 'rgba(255, 99, 132, 1)',
                            fill: false
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: { y: { beginAtZero: false } },
                        plugins: { legend: { position: 'top' } }
                    }
                });
            };
        }

        window.addEventListener('load', () => {
            initDB();
            displayProgress();

            document.getElementById('theme-toggle').addEventListener('click', () => {
                document.body.classList.toggle('dark-mode');
                const isDarkMode = document.body.classList.contains('dark-mode');
                localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
                document.getElementById('theme-toggle').textContent = isDarkMode ? '切换浅色模式' : '切换深色模式';
            });

            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                document.getElementById('theme-toggle').textContent = '切换浅色模式';
            }

            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => console.log('Service Worker 注册成功:', registration))
                    .catch(error => console.log('Service Worker 注册失败:', error));
            }
        });

        function toggleDetails(id) {
            const details = document.getElementById(id);
            const button = document.querySelector(`[aria-controls="${id}"]`);
            const isExpanded = button.getAttribute("aria-expanded") === "true";
            button.setAttribute("aria-expanded", !isExpanded);
            details.setAttribute("aria-hidden", isExpanded);
        }
    </script>
</body>
</html>